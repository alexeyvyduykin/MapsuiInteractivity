using Mapsui;
using Mapsui.Interactivity;
using Mapsui.Interactivity.Utilities;
using Mapsui.Layers;
using Mapsui.Nts;
using Mapsui.Nts.Extensions;
using Mapsui.Styles;
using Mapsui.Styles.Thematics;
using NetTopologySuite.Geometries;
using NetTopologySuite.IO;

namespace HoverSample.Models;

internal static class MapBuilder
{
    private static readonly string wktPolygon1 = "POLYGON ((991912.3149597258 5524678.959929607, 1075904.3595377824 5661013.872867901, 1170851.8881912378 5615974.6605579285, 1229281.136593364 5707270.36118625, 1375354.2575986795 5691445.773077341, 1398482.5017578548 5613540.108541172, 1352226.013439505 5563631.792197689, 1445956.2660845825 5490595.231695032, 1285275.8329787347 5562414.516189312, 1133116.3319315307 5456511.503460458, 991912.3149597258 5524678.959929607))";
    private static readonly string wktCircle1 = "POLYGON ((1768578.3056497877 5141313.400461309, 1774369.9944382226 5141212.306157462, 1780154.6269460102 5140909.14641376, 1785925.1554894939 5140404.290583653, 1791674.5495685253 5139698.353756201, 1797395.8044320454 5138792.196006688, 1803081.9496122948 5137686.92134875, 1808726.0574172547 5136383.876389301, 1814321.251370973 5134884.648687907, 1819860.7145914906 5133191.0648225825, 1825337.6980961624 5131305.1881643925, 1830745.5290242524 5129229.316363546, 1836077.6187667872 5126965.978550071, 1841327.4709937612 5124517.932252451, 1846488.6895689133 5121888.160038007, 1851554.9863424345 5119079.865879099, 1856520.1888121096 5116096.471249572, 1861378.2476435602 5112941.610956228, 1866123.2440404266 5109619.128710364, 1870749.39695551 5106133.072444809, 1875251.0701340872 5102487.689382134, 1879622.7789808202 5098687.420860075, 1883859.197241889 5094736.89692044, 1887955.163494213 5090640.930668116, 1891905.6874338489 5086404.512407047, 1895705.9559559077 5082032.803560314, 1899351.3390185817 5077531.130381737, 1902837.3952841377 5072904.977466653, 1906159.8775300013 5068159.981069787, 1909314.7378233455 5063301.922238337, 1912298.1324528717 5058336.719768661, 1915106.4266117804 5053270.42299514, 1917736.1988262238 5048109.204419988, 1920184.245123844 5042859.352193014, 1922447.5829373195 5037527.262450479, 1924523.4547381655 5032119.431522389, 1926409.331396356 5026642.448017717, 1928102.91526168 5021102.9847972, 1929602.1429630744 5015507.790843481, 1930905.1879225231 5009863.683038522, 1932010.462580462 5004177.537858272, 1932916.6203299747 4998456.282994752, 1933622.5571574261 4992706.88891572, 1934127.4129875337 4986936.360372237, 1934430.5727312355 4981151.72786445, 1934531.6670350817 4975360.039076014, 1934430.5727312355 4969568.350287579, 1934127.4129875337 4963783.717779792, 1933622.5571574261 4958013.189236308, 1932916.6203299747 4952263.795157277, 1932010.462580462 4946542.540293757, 1930905.1879225231 4940856.395113507, 1929602.1429630744 4935212.287308548, 1928102.91526168 4929617.09335483, 1926409.331396356 4924077.6301343115, 1924523.4547381655 4918600.64662964, 1922447.5829373195 4913192.81570155, 1920184.245123844 4907860.725959015, 1917736.1988262238 4902610.873732041, 1915106.4266117807 4897449.655156889, 1912298.1324528717 4892383.358383368, 1909314.7378233455 4887418.155913692, 1906159.8775300013 4882560.097082241, 1902837.3952841377 4877815.100685376, 1899351.339018582 4873188.947770292, 1895705.9559559077 4868687.274591715, 1891905.6874338489 4864315.565744982, 1887955.163494213 4860079.147483913, 1883859.197241889 4855983.181231589, 1879622.77898082 4852032.657291953, 1875251.0701340872 4848232.388769895, 1870749.39695551 4844587.00570722, 1866123.2440404266 4841100.949441665, 1861378.2476435602 4837778.4671958005, 1856520.1888121096 4834623.606902457, 1851554.9863424345 4831640.21227293, 1846488.6895689133 4828831.918114021, 1841327.4709937612 4826202.145899578, 1836077.6187667872 4823754.099601958, 1830745.5290242524 4821490.761788483, 1825337.6980961624 4819414.889987636, 1819860.7145914906 4817529.013329446, 1814321.251370973 4815835.429464122, 1808726.0574172547 4814336.201762727, 1803081.9496122948 4813033.156803279, 1797395.8044320454 4811927.882145341, 1791674.5495685253 4811021.724395827, 1785925.155489494 4810315.7875683755, 1780154.6269460104 4809810.931738269, 1774369.9944382226 4809507.771994567, 1768578.3056497877 4809406.67769072, 1762786.6168613527 4809507.771994567, 1757001.9843535651 4809810.931738269, 1751231.4558100812 4810315.7875683755, 1745482.0617310498 4811021.724395827, 1739760.8068675299 4811927.882145341, 1734074.6616872805 4813033.156803279, 1728430.5538823206 4814336.201762727, 1722835.3599286024 4815835.429464122, 1717295.8967080845 4817529.013329446, 1711818.913203413 4819414.889987636, 1706411.0822753229 4821490.761788483, 1701078.992532788 4823754.099601958, 1695829.1403058143 4826202.145899578, 1690667.921730662 4828831.918114021, 1685601.6249571408 4831640.21227293, 1680636.4224874657 4834623.606902457, 1675778.3636560151 4837778.4671958005, 1671033.3672591487 4841100.949441665, 1666407.2143440656 4844587.00570722, 1661905.541165488 4848232.388769895, 1657533.832318755 4852032.657291953, 1653297.4140576862 4855983.181231589, 1649201.4478053623 4860079.147483913, 1645250.9238657265 4864315.565744982, 1641450.6553436676 4868687.274591715, 1637805.2722809934 4873188.947770292, 1634319.2160154376 4877815.100685376, 1630996.733769574 4882560.097082241, 1627841.8734762298 4887418.155913692, 1624858.4788467037 4892383.358383368, 1622050.184687795 4897449.655156889, 1619420.4124733515 4902610.873732041, 1616972.3661757314 4907860.725959015, 1614709.0283622558 4913192.81570155, 1612633.1565614098 4918600.64662964, 1610747.2799032193 4924077.6301343115, 1609053.6960378953 4929617.09335483, 1607554.468336501 4935212.287308548, 1606251.4233770522 4940856.395113507, 1605146.1487191133 4946542.540293757, 1604239.9909696009 4952263.795157277, 1603534.0541421492 4958013.1892363075, 1603029.1983120416 4963783.717779792, 1602726.0385683398 4969568.350287579, 1602624.9442644936 4975360.039076014, 1602726.0385683398 4981151.727864449, 1603029.1983120416 4986936.360372237, 1603534.0541421492 4992706.88891572, 1604239.9909696006 4998456.282994752, 1605146.1487191133 5004177.537858272, 1606251.4233770522 5009863.683038522, 1607554.468336501 5015507.790843481, 1609053.6960378953 5021102.984797199, 1610747.2799032193 5026642.448017717, 1612633.1565614098 5032119.431522389, 1614709.0283622558 5037527.262450479, 1616972.3661757314 5042859.352193014, 1619420.4124733515 5048109.204419988, 1622050.1846877947 5053270.42299514, 1624858.4788467037 5058336.719768661, 1627841.8734762298 5063301.922238337, 1630996.733769574 5068159.981069787, 1634319.2160154376 5072904.977466653, 1637805.2722809934 5077531.130381737, 1641450.6553436676 5082032.803560314, 1645250.9238657265 5086404.512407047, 1649201.4478053623 5090640.930668116, 1653297.4140576862 5094736.89692044, 1657533.832318755 5098687.420860075, 1661905.541165488 5102487.689382134, 1666407.2143440654 5106133.072444809, 1671033.3672591487 5109619.128710364, 1675778.363656015 5112941.610956228, 1680636.4224874654 5116096.471249572, 1685601.6249571405 5119079.865879098, 1690667.921730662 5121888.160038007, 1695829.140305814 5124517.932252451, 1701078.992532788 5126965.978550071, 1706411.0822753229 5129229.316363546, 1711818.913203413 5131305.1881643925, 1717295.8967080847 5133191.0648225825, 1722835.3599286024 5134884.648687907, 1728430.5538823206 5136383.876389301, 1734074.6616872805 5137686.92134875, 1739760.8068675299 5138792.196006688, 1745482.0617310498 5139698.353756201, 1751231.4558100812 5140404.290583653, 1757001.984353565 5140909.14641376, 1762786.6168613527 5141212.306157462, 1768578.3056497877 5141313.400461309))";
    private static readonly string wktRectangle1 = "POLYGON ((1199513.0851808232 5265186.30704513, 1707054.9529943874 5265186.30704513, 1707054.9529943874 5158785.963672167, 1199513.0851808232 5158785.963672167, 1199513.0851808232 5265186.30704513))";
    private static readonly string wktPoint1 = "POINT (1399513.0851808232 5465186.30704513)";
    private static readonly string wktRoute1 = "LINESTRING (1042158.9502034901 5321132.10610815, 1154674.2558392682 5217177.747640314, 966333.4181445962 5190271.913683931, 1025037.0558676108 5066749.675975089, 922305.6898523355 4964018.309959814, 1080071.7162329375 4973802.249580316, 951657.508713843 4740210.691140819, 1236614.7501609768 5054519.751449459, 1072733.761517561 5145021.192939107)";

    private static readonly string wktPolygon3 = "POLYGON ((1398592.392840698 5203145.517406791, 1473729.5114644128 5395496.541083502, 1715170.1193086167 5415533.106049826, 1625005.576960159 5317353.937714838, 1541853.8323499144 5356425.2393991705, 1610979.9814837321 5199138.204413527, 1391579.5951024846 4958699.424817639, 1542855.6605982305 5208154.658648373, 1372544.8583844767 5108973.662065069, 1296405.9115124457 5205149.173903424, 1398592.392840698 5203145.517406791))";
    private static readonly string wktCircle3 = "POLYGON ((1680106.13061755 5056197.059113244, 1685709.4292316139 5056099.253172123, 1691305.9010894387 5055805.954510234, 1696888.7277521356 5055317.520466818, 1702451.107405385 5054634.546123518, 1707986.2631463984 5053757.863579368, 1713487.4512405302 5052688.5409370065, 1718947.9693374815 5051427.881001355, 1724361.164637079 5049977.419692356, 1729720.4419946892 5048338.924173688, 1735019.271956385 5046514.390699749, 1740251.1987140807 5044506.0421835305, 1745409.847970938 5042316.325488336, 1750488.934707467 5039947.908446659, 1755482.270838852 5037403.676609838, 1760383.7727541819 5034686.7297324585, 1765187.468728391 5031800.377995774, 1769887.5061978875 5028748.137974771, 1774478.158891 5025533.728353751, 1778953.833804558 5022161.065395695, 1783309.078018104 5018634.258170901, 1787538.585337438 5014957.603550708, 1791637.2027593965 5011135.580972425, 1795599.936749995 5007172.846981826, 1799421.959328278 5003074.229559868, 1803098.6139484716 4998844.722240534, 1806625.4211732661 4994489.478026988, 1809998.0841313212 4990013.80311343, 1813212.4937523413 4985423.150420317, 1816264.7337733451 4980723.1129508205, 1819151.0855100285 4975919.416976611, 1821868.032387409 4971017.915061282, 1824412.2642242296 4966024.5789298965, 1826780.6812659067 4960945.492193367, 1828970.397961101 4955786.84293651, 1830978.7464773196 4950554.916178815, 1832803.2799512583 4945256.086217118, 1834441.7754699264 4939896.8088595085, 1835892.2367789254 4934483.613559911, 1837152.896714577 4929023.09546296, 1838222.2193569392 4923521.907368828, 1839098.9019010887 4917986.751627815, 1839781.876244388 4912424.371974565, 1840270.3102878043 4906841.545311868, 1840563.608949693 4901245.073454044, 1840661.4148908136 4895641.77483998, 1840563.608949693 4890038.476225915, 1840270.3102878043 4884442.004368091, 1839781.876244388 4878859.177705394, 1839098.9019010887 4873296.798052145, 1838222.2193569392 4867761.642311132, 1837152.896714577 4862260.454216999, 1835892.2367789254 4856799.936120048, 1834441.7754699264 4851386.740820451, 1832803.2799512583 4846027.463462841, 1830978.7464773196 4840728.633501144, 1828970.397961101 4835496.706743449, 1826780.6812659067 4830338.057486592, 1824412.2642242296 4825258.970750063, 1821868.032387409 4820265.634618677, 1819151.0855100285 4815364.132703348, 1816264.7337733451 4810560.436729139, 1813212.4937523413 4805860.399259642, 1809998.0841313212 4801269.746566529, 1806625.4211732661 4796794.071652971, 1803098.6139484716 4792438.8274394255, 1799421.959328278 4788209.320120092, 1795599.936749995 4784110.702698133, 1791637.2027593965 4780147.9687075345, 1787538.5853374377 4776325.946129251, 1783309.078018104 4772649.291509058, 1778953.833804558 4769122.484284264, 1774478.158891 4765749.821326208, 1769887.5061978875 4762535.411705188, 1765187.468728391 4759483.171684185, 1760383.7727541819 4756596.819947501, 1755482.270838852 4753879.873070121, 1750488.934707467 4751335.6412333, 1745409.847970938 4748967.224191623, 1740251.1987140807 4746777.507496429, 1735019.271956385 4744769.15898021, 1729720.4419946894 4742944.625506272, 1724361.1646370792 4741306.129987603, 1718947.9693374815 4739855.668678604, 1713487.4512405302 4738595.008742953, 1707986.2631463984 4737525.686100591, 1702451.107405385 4736649.0035564415, 1696888.7277521356 4735966.029213142, 1691305.9010894387 4735477.595169725, 1685709.429231614 4735184.296507836, 1680106.13061755 4735086.490566716, 1674502.8320034863 4735184.296507836, 1668906.3601456617 4735477.595169725, 1663323.5334829646 4735966.029213142, 1657761.1538297152 4736649.0035564415, 1652225.9980887019 4737525.686100591, 1646724.80999457 4738595.008742953, 1641264.2918976187 4739855.668678604, 1635851.0965980212 4741306.129987603, 1630491.8192404108 4742944.625506272, 1625192.989278715 4744769.15898021, 1619961.0625210195 4746777.507496429, 1614802.4132641621 4748967.224191623, 1609723.3265276332 4751335.6412333, 1604729.9903962482 4753879.873070121, 1599828.4884809183 4756596.819947502, 1595024.7925067092 4759483.171684185, 1590324.7550372127 4762535.411705188, 1585734.1023441001 4765749.821326208, 1581258.4274305422 4769122.484284264, 1576903.1832169963 4772649.291509058, 1572673.6758976623 4776325.946129251, 1568575.0584757037 4780147.9687075345, 1564612.3244851055 4784110.702698133, 1560790.3019068222 4788209.320120092, 1557113.6472866286 4792438.8274394255, 1553586.840061834 4796794.071652972, 1550214.177103779 4801269.746566529, 1546999.767482759 4805860.399259642, 1543947.527461755 4810560.436729139, 1541061.1757250717 4815364.132703348, 1538344.2288476913 4820265.634618677, 1535799.9970108706 4825258.970750063, 1533431.5799691936 4830338.057486592, 1531241.8632739992 4835496.706743449, 1529233.5147577806 4840728.633501144, 1527408.981283842 4846027.463462841, 1525770.4857651738 4851386.740820451, 1524320.0244561748 4856799.936120048, 1523059.3645205232 4862260.454216999, 1521990.041878161 4867761.642311132, 1521113.3593340116 4873296.798052144, 1520430.3849907122 4878859.177705394, 1519941.9509472959 4884442.004368091, 1519648.6522854073 4890038.476225915, 1519550.8463442866 4895641.77483998, 1519648.6522854073 4901245.073454044, 1519941.9509472959 4906841.545311868, 1520430.3849907122 4912424.371974565, 1521113.3593340116 4917986.751627815, 1521990.041878161 4923521.907368828, 1523059.3645205232 4929023.09546296, 1524320.0244561748 4934483.613559911, 1525770.4857651738 4939896.8088595085, 1527408.981283842 4945256.086217118, 1529233.5147577806 4950554.916178815, 1531241.8632739992 4955786.84293651, 1533431.5799691936 4960945.492193367, 1535799.9970108706 4966024.5789298965, 1538344.2288476913 4971017.915061282, 1541061.1757250717 4975919.416976611, 1543947.527461755 4980723.1129508205, 1546999.767482759 4985423.150420317, 1550214.177103779 4990013.80311343, 1553586.840061834 4994489.478026987, 1557113.6472866286 4998844.722240534, 1560790.3019068222 5003074.229559868, 1564612.3244851052 5007172.846981826, 1568575.0584757037 5011135.580972425, 1572673.6758976623 5014957.603550707, 1576903.183216996 5018634.258170901, 1581258.4274305422 5022161.065395695, 1585734.1023441001 5025533.728353751, 1590324.7550372127 5028748.137974771, 1595024.7925067092 5031800.377995774, 1599828.4884809183 5034686.729732458, 1604729.9903962482 5037403.676609838, 1609723.3265276332 5039947.908446659, 1614802.4132641621 5042316.325488336, 1619961.0625210195 5044506.0421835305, 1625192.9892787149 5046514.390699749, 1630491.8192404108 5048338.924173688, 1635851.0965980212 5049977.419692356, 1641264.2918976187 5051427.881001355, 1646724.8099945697 5052688.5409370065, 1652225.9980887019 5053757.863579368, 1657761.1538297152 5054634.546123518, 1663323.5334829644 5055317.520466818, 1668906.3601456615 5055805.954510234, 1674502.8320034863 5056099.253172123, 1680106.13061755 5056197.059113244))";
    private static readonly string wktRectangle3 = "POLYGON ((899681.9251792311 5505062.121663876, 1271498.5793719878 5505062.121663876, 1271498.5793719878 5233576.945586625, 899681.9251792311 5233576.945586625, 899681.9251792311 5505062.121663876))";
    private static readonly string wktPoint3 = "POINT (1718175.6040535658 4944673.829341205)";
    private static readonly string wktRoute3 = "LINESTRING (1318446.1329754016 4914618.981891724, 1436661.866276713 4882560.477945606, 1478738.6527059935 4934655.546858048, 1614987.2944769964 4842487.348012958, 1773276.157710956 4900593.386415298, 1673093.332879336 4992761.585260388, 1995682.028837152 5084929.784105478, 1913532.1124752238 5247225.960332703)";

    private static readonly string wktFootprint1 = "POLYGON((953170.274584888 4513624.046743402, 1129656.021478541 4631781.860505304, 1248928.5315966862 4453631.153735297, 1072442.7847030333 4335473.339973395, 953170.274584888 4513624.046743402))";
    private static readonly string wktFootprint2 = "POLYGON ((1101049.403090787 4554757.4058698015, 1335477.2131967775 4554757.4058698015, 1335477.2131967775 4316322.282770546, 1101049.403090787 4316322.282770546, 1101049.403090787 4554757.4058698015))";
    private static readonly string wktFootprint3 = "POLYGON ((1022906.7997221234 4610859.787775508, 1207243.197412304 4610859.787775508, 1207243.197412304 4374428.321172886, 1022906.7997221234 4374428.321172886, 1022906.7997221234 4610859.787775508))";
    private static readonly string wktFootprint4 = "POLYGON ((1167170.067479656 4656943.887198053, 1449685.6335048242 4656943.887198053, 1449685.6335048242 4394464.886139209, 1167170.067479656 4394464.886139209, 1167170.067479656 4656943.887198053))";

    private static readonly Color backgroundColor = new(20, 120, 120, 40);
    private static readonly Color lineColor = new(20, 120, 120);
    private static readonly Color outlineColor = new(20, 20, 20);
        
    public const string SelectField = "Select";
       
    public const string HoverField = "Hover";

    public static Map Create()
    {
        var map = new Map()
        {
            CRS = "EPSG:3857",
        };

        map.Layers.Add(CreateLayer1());
        map.Layers.Add(CreateLayer2());
        map.Layers.Add(CreateLayer3());

        return map;
    }

    private static WritableLayer CreateLayer1()
    {
        var layer = new WritableLayer()
        {
            Name = "Layer1",
            IsMapInfoLayer = true,
            Style = CreateUserLayerStyle(),
        };

        layer.Add(CreateFeature("Polygon1", wktPolygon1));
        layer.Add(CreateFeature("Circle1", wktCircle1));
        layer.Add(CreateFeature("Rectangle1", wktRectangle1));
        layer.Add(CreateFeature("Route1", wktRoute1));
        layer.Add(CreateFeature("Point1", wktPoint1));

        return layer;
    }

    private static ILayer CreateLayer2()
    {
        var layer = new WritableLayer()
        {
            Name = "Layer2",
            IsMapInfoLayer = false,
            Style = new VectorStyle()
            {
                Fill = new Brush(new Color(0, 0, 0, 40)),
                Line = new Pen(Color.Black, 2),
                Outline = new Pen(Color.Black, 2)
            },
        };

        var feature = CreateFeature("Polygon2", wktPolygon1);

        Geomorpher.Translate(((GeometryFeature)feature).Geometry!, 700000, 0);

        layer.Add(feature);

        return layer;
    }

    private static WritableLayer CreateLayer3()
    {
        var layer = new WritableLayer()
        {
            Name = "Layer3",
            IsMapInfoLayer = true,
            Style = CreateUserLayerStyle(),
        };

        layer.Add(CreateFeature("Polygon3", wktPolygon3));
        layer.Add(CreateFeature("Circle3", wktCircle3));
        layer.Add(CreateFeature("Rectangle3", wktRectangle3));
        layer.Add(CreateFeature("Route3", wktRoute3));
        layer.Add(CreateFeature("Point3", wktPoint3));

        layer.Add(CreateFeature("Footprint1", wktFootprint1));
        layer.Add(CreateFeature("Footprint2", wktFootprint2));
        layer.Add(CreateFeature("Footprint3", wktFootprint3));
        layer.Add(CreateFeature("Footprint4", wktFootprint4));

        return layer;
    }

    private static IStyle CreateUserLayerStyle()
    {
        return new ThemeStyle(f =>
        {
            if (f is not GeometryFeature gf)
            {
                return null;
            }

            var isSelect = gf[SelectField];
            var isHover = gf[HoverField];

            if (isSelect is bool and true)
            {
                if (gf.Geometry is Point)
                {
                    return new SymbolStyle
                    {
                        SymbolType = SymbolType.Triangle,
                        Fill = new Brush(Color.Green),
                        SymbolScale = 1.0,
                    };
                }

                return new VectorStyle()
                {
                    Fill = new Brush(new Color(backgroundColor)),
                    Outline = new Pen(Color.Violet, 6),
                    Line = new Pen(Color.Violet, 6),
                };
            }

            if (isHover is bool and true)
            {
                if (gf.Geometry is Point)
                {
                    return new SymbolStyle
                    {
                        SymbolType = SymbolType.Triangle,
                        Fill = new Brush(Color.Green),
                        SymbolScale = 1.0,
                    };
                }

                return new VectorStyle()
                {
                    Fill = new Brush(new Color(backgroundColor)),
                    Outline = new Pen(Color.Yellow, 3),
                    Line = new Pen(Color.Yellow, 3),
                };
            }

            if (gf.Geometry is Point)
            {
                return new SymbolStyle
                {
                    SymbolType = SymbolType.Triangle,
                    Fill = new Brush(Color.Red),
                    SymbolScale = 1.0,
                };
            }

            var defaultStyle = new VectorStyle
            {
                Fill = new Brush(new Color(backgroundColor)),
                Line = new Pen(lineColor, 3),
                Outline = new Pen(outlineColor, 3)
            };

            return defaultStyle;
        });
    }

    private static IFeature CreateFeature(string name, string wkt, IStyle? style = null)
    {
        var g = new WKTReader().Read(wkt);

        var feature = g.ToFeature(name);

        if (style != null)
        {
            feature.Styles = new[] { style };
        }

        return feature;
    }
}
